Loading precomputed tool embeddings...
✓ Loaded embeddings shape: (8, 768)
Loading mpnet-base-v2 for query encoding...
Loading Dhaka...
✓ Loaded 117,986 nodes, 289,659 edges


================================================================================
COMPREHENSIVE TEST: ALL 8 TOOLS WITH MPNET EMBEDDINGS
================================================================================

[Test 1/21] Category: geocoding
Query: Find the coordinates for Uttara Hospital
Expected tool: geocode_place
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.382', '0.361']
Actual tool: geocode_place ✓ PASS
Timing: 0.206s (selection) + 31.80s (LLM) = 32.00s
Tokens: 309 prompt, 25 completion
Arguments: {
  "place_name": "Uttara Hospital"
}

[Test 2/21] Category: geocoding
Query: What are the GPS coordinates of Dhanmondi Lake?
Expected tool: geocode_place
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.408', '0.385']
Actual tool: geocode_place ✓ PASS
Timing: 0.210s (selection) + 3.81s (LLM) = 4.02s
Tokens: 314 prompt, 26 completion
Arguments: {
  "place_name": "Dhanmondi Lake"
}

[Test 3/21] Category: reachability
Query: Show me everywhere I can walk to in 15 minutes from 23.8747, 90.3967
Expected tool: generate_isochrone
--------------------------------------------------------------------------------
Selected tools: ['generate_isochrone', 'find_nearest_poi_with_route']
Similarities: ['0.573', '0.507']
Actual tool: generate_isochrone ✓ PASS
Timing: 0.236s (selection) + 25.29s (LLM) = 25.53s
Tokens: 406 prompt, 50 completion
Arguments: {
  "max_minutes": 15,
  "start_lat": 23.8747,
  "start_lon": 90.3967
}

[Test 4/21] Category: reachability
Query: What areas are accessible within 10 minutes walking from this location: 23.8700, 90.3950
Expected tool: generate_isochrone
--------------------------------------------------------------------------------
Selected tools: ['generate_isochrone', 'find_nearest_poi_with_route']
Similarities: ['0.510', '0.444']
Actual tool: generate_isochrone ✓ PASS
Timing: 0.221s (selection) + 8.00s (LLM) = 8.22s
Tokens: 407 prompt, 50 completion
Arguments: {
  "max_minutes": 10,
  "start_lat": 23.87,
  "start_lon": 90.395
}

[Test 5/21] Category: reachability_with_pois
Query: Find all hospitals I can reach in 15 minutes walking from 23.8747, 90.3967
Expected tool: generate_isochrone
--------------------------------------------------------------------------------
Selected tools: ['generate_isochrone', 'list_pois']
Similarities: ['0.566', '0.496']
Actual tool: generate_isochrone ✓ PASS
Timing: 0.222s (selection) + 15.10s (LLM) = 15.32s
Tokens: 375 prompt, 50 completion
Arguments: {
  "max_minutes": 15,
  "start_lat": 23.8747,
  "start_lon": 90.3967
}

[Test 6/21] Category: nearest_walking
Query: Which hospital is actually closest by walking distance from 23.8700, 90.3950?
Expected tool: find_nearest_poi_with_route
--------------------------------------------------------------------------------
Selected tools: ['find_nearest_poi_with_route', 'generate_isochrone']
Similarities: ['0.437', '0.379']
Actual tool: find_nearest_poi_with_route ✓ PASS
Timing: 0.223s (selection) + 36.48s (LLM) = 36.70s
Tokens: 403 prompt, 142 completion
Arguments: {
  "max_radius_m": 5000,
  "max_results": 1,
  "poi_type": "hospital",
  "start_lat": 23.87,
  "start_lon": 90.395
}

[Test 7/21] Category: nearest_walking
Query: Find the nearest 3 restaurants with actual walking routes from 23.8103, 90.4125
Expected tool: find_nearest_poi_with_route
--------------------------------------------------------------------------------
Selected tools: ['find_nearest_poi_with_route', 'generate_isochrone']
Similarities: ['0.558', '0.536']
Actual tool: find_nearest_poi_with_route ✓ PASS
Timing: 0.239s (selection) + 7.65s (LLM) = 7.89s
Tokens: 404 prompt, 52 completion
Arguments: {
  "poi_type": "restaurant",
  "start_lat": 23.8103,
  "start_lon": 90.4125
}

[Test 8/21] Category: nearest_walking
Query: Show me nearby pharmacies with real walking distances, not straight-line
Expected tool: find_nearest_poi_with_route
--------------------------------------------------------------------------------
Selected tools: ['find_nearest_poi_with_route', 'generate_isochrone']
Similarities: ['0.623', '0.513']
Actual tool: None ✗ FAIL
Timing: 0.217s (selection) + 4.27s (LLM) = 4.48s
Tokens: 388 prompt, 30 completion

[Test 9/21] Category: single_count
Query: Count hospitals within 2km of 23.8103, 90.4125
Expected tool: count_pois
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'count_pois']
Similarities: ['0.456', '0.450']
Actual tool: count_pois ✓ PASS
Timing: 0.218s (selection) + 21.08s (LLM) = 21.30s
Tokens: 309 prompt, 56 completion
Arguments: {
  "lat": 23.8103,
  "lon": 90.4125,
  "poi_type": "hospital",
  "radius_m": 2000
}

[Test 10/21] Category: single_count
Query: How many schools exist near 23.8747, 90.3967?
Expected tool: count_pois
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'count_pois']
Similarities: ['0.344', '0.333']
Actual tool: count_pois ✓ PASS
Timing: 0.216s (selection) + 6.53s (LLM) = 6.75s
Tokens: 308 prompt, 46 completion
Arguments: {
  "lat": 23.8747,
  "lon": 90.3967,
  "poi_type": "school"
}

[Test 11/21] Category: single_list
Query: List restaurant names and locations near 23.8103, 90.4125
Expected tool: list_pois
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.457', '0.445']
Actual tool: list_pois ✓ PASS
Timing: 0.209s (selection) + 15.26s (LLM) = 15.47s
Tokens: 325 prompt, 46 completion
Arguments: {
  "lat": 23.8103,
  "lon": 90.4125,
  "poi_type": "restaurant"
}

[Test 12/21] Category: single_list
Query: Show me all pharmacy names with their distances from 23.8747, 90.3967
Expected tool: list_pois
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'find_nearest_poi_with_route']
Similarities: ['0.581', '0.435']
Actual tool: list_pois ✓ PASS
Timing: 0.213s (selection) + 16.68s (LLM) = 16.90s
Tokens: 345 prompt, 47 completion
Arguments: {
  "lat": 23.8747,
  "lon": 90.3967,
  "poi_type": "pharmacy"
}

[Test 13/21] Category: route
Query: Calculate walking distance from 23.8103, 90.4125 to 23.8200, 90.4200
Expected tool: calculate_route
--------------------------------------------------------------------------------
Selected tools: ['calculate_route', 'generate_isochrone']
Similarities: ['0.702', '0.676']
Actual tool: calculate_route ✓ PASS
Timing: 0.221s (selection) + 26.00s (LLM) = 26.22s
Tokens: 371 prompt, 66 completion
Arguments: {
  "end_lat": 23.82,
  "end_lon": 90.42,
  "start_lat": 23.8103,
  "start_lon": 90.4125
}

[Test 14/21] Category: route
Query: What is the pedestrian path between these two coordinates: 23.8747, 90.3967 and 23.8700, 90.3950?
Expected tool: calculate_route
--------------------------------------------------------------------------------
Selected tools: ['calculate_route', 'generate_isochrone']
Similarities: ['0.703', '0.468']
Actual tool: calculate_route ✓ PASS
Timing: 0.233s (selection) + 10.00s (LLM) = 10.23s
Tokens: 378 prompt, 65 completion
Arguments: {
  "end_lat": 23.87,
  "end_lon": 90.395,
  "start_lat": 23.8747,
  "start_lon": 90.3967
}

[Test 15/21] Category: multi_count
Query: Compare hospitals, pharmacies, and schools within 1.5km of 23.8103, 90.4125
Expected tool: count_pois_multiple_types
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.412', '0.389']
Actual tool: None ✗ FAIL
Timing: 0.230s (selection) + 57.27s (LLM) = 57.50s
Tokens: 333 prompt, 380 completion

[Test 16/21] Category: multi_count
Query: Batch count: schools, libraries, and banks within 2km of 23.8747, 90.3967
Expected tool: count_pois_multiple_types
--------------------------------------------------------------------------------
Selected tools: ['count_pois', 'list_pois']
Similarities: ['0.440', '0.435']
Actual tool: count_pois ✗ FAIL
Timing: 0.232s (selection) + 22.03s (LLM) = 22.26s
Tokens: 316 prompt, 62 completion
Arguments: {
  "lat": 23.8747,
  "lon": 90.3967,
  "poi_type": [
    "school",
    "library",
    "bank"
  ],
  "radius_m": 2000
}

[Test 17/21] Category: multi_count
Query: Count several POI categories simultaneously: cafes, restaurants, and bars near 23.8103, 90.4125
Expected tool: count_pois_multiple_types
--------------------------------------------------------------------------------
Selected tools: ['count_pois', 'list_pois']
Similarities: ['0.613', '0.496']
Actual tool: count_pois ✗ FAIL
Timing: 0.239s (selection) + 7.89s (LLM) = 8.12s
Tokens: 316 prompt, 53 completion
Arguments: {
  "lat": 23.8103,
  "lon": 90.4125,
  "poi_type": [
    "cafes",
    "restaurants",
    "bars"
  ]
}

[Test 18/21] Category: visualization_intent
Query: Create a map showing all hospitals around 23.8103, 90.4125
Expected tool: list_pois
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.514', '0.474']
Actual tool: geocode_place ✗ FAIL
Timing: 0.219s (selection) + 26.66s (LLM) = 26.88s
Tokens: 326 prompt, 99 completion
Arguments: {
  "category": "amenity",
  "max_results": 5,
  "place_name": "hospital"
}

[Test 19/21] Category: emergency_routing
Query: If I'm at 23.8700, 90.3950 and need a hospital urgently, which is fastest to reach by foot?
Expected tool: find_nearest_poi_with_route
--------------------------------------------------------------------------------
Selected tools: ['generate_isochrone', 'calculate_route']
Similarities: ['0.444', '0.439']
Actual tool: calculate_route ✗ FAIL
Timing: 0.234s (selection) + 24.65s (LLM) = 24.89s
Tokens: 367 prompt, 54 completion
Arguments: {
  "end_lat": 0,
  "end_lon": 0,
  "start_lat": 23.87,
  "start_lon": 90.395
}

[Test 20/21] Category: comparison_query
Query: Are there more schools or hospitals in the Uttara area near 23.8747, 90.3967?
Expected tool: count_pois_multiple_types
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'geocode_place']
Similarities: ['0.295', '0.266']
Actual tool: list_pois ✗ FAIL
Timing: 0.224s (selection) + 28.83s (LLM) = 29.06s
Tokens: 332 prompt, 116 completion
Arguments: {
  "lat": 23.8747,
  "lon": 90.3967,
  "poi_type": "school",
  "radius_m": 1000
}

[Test 21/21] Category: multi_step_geocode
Query: Find a place called Uttara Medical College and then show me pharmacies nearby
Expected tool: geocode_place
--------------------------------------------------------------------------------
Selected tools: ['list_pois', 'find_nearest_poi_with_route']
Similarities: ['0.204', '0.184']
Actual tool: find_nearest_poi_with_route ✗ FAIL
Timing: 0.216s (selection) + 16.95s (LLM) = 17.17s
Tokens: 333 prompt, 57 completion
Arguments: {
  "poi_type": "pharmacy",
  "start_lat": 24.751398,
  "start_lon": 86.903678
}

================================================================================
TEST SUMMARY
================================================================================

Accuracy: 13/21 (61.9%)
Passed: 13
Failed: 8

Average Timing:
  Tool selection: 0.223s
  LLM inference: 19.63s
  Total: 19.85s

Average Tokens:
  Prompt: 351
  Completion: 75
  Total: 426

Performance by Category:
  comparison_query              : 0/1 (0%) - avg 29.1s
  emergency_routing             : 0/1 (0%) - avg 24.9s
  geocoding                     : 2/2 (100%) - avg 18.0s
  multi_count                   : 0/3 (0%) - avg 29.3s
  multi_step_geocode            : 0/1 (0%) - avg 17.2s
  nearest_walking               : 2/3 (67%) - avg 16.4s
  reachability                  : 2/2 (100%) - avg 16.9s
  reachability_with_pois        : 1/1 (100%) - avg 15.3s
  route                         : 2/2 (100%) - avg 18.2s
  single_count                  : 2/2 (100%) - avg 14.0s
  single_list                   : 2/2 (100%) - avg 16.2s
  visualization_intent          : 0/1 (0%) - avg 26.9s

Tool Selection Frequency:
  list_pois                          : selected 13 times
  generate_isochrone                 : selected  9 times
  find_nearest_poi_with_route        : selected  7 times
  geocode_place                      : selected  6 times
  count_pois                         : selected  4 times
  calculate_route                    : selected  3 times

Per-Tool Accuracy:
  calculate_route                    : 2/2 (100%)
  count_pois                         : 2/2 (100%)
  count_pois_multiple_types          : 0/4 (0%)
  find_nearest_poi_with_route        : 2/4 (50%)
  generate_isochrone                 : 3/3 (100%)
  geocode_place                      : 2/3 (67%)
  list_pois                          : 2/3 (67%)

Failed Cases Detail:

  Query: Show me nearby pharmacies with real walking distances, not straight-li...
    Expected: find_nearest_poi_with_route
    Got: None
    Selected tools: ['find_nearest_poi_with_route', 'generate_isochrone']
    Similarities: ['0.623', '0.513']

  Query: Compare hospitals, pharmacies, and schools within 1.5km of 23.8103, 90...
    Expected: count_pois_multiple_types
    Got: None
    Selected tools: ['list_pois', 'geocode_place']
    Similarities: ['0.412', '0.389']

  Query: Batch count: schools, libraries, and banks within 2km of 23.8747, 90.3...
    Expected: count_pois_multiple_types
    Got: count_pois
    Selected tools: ['count_pois', 'list_pois']
    Similarities: ['0.440', '0.435']

  Query: Count several POI categories simultaneously: cafes, restaurants, and b...
    Expected: count_pois_multiple_types
    Got: count_pois
    Selected tools: ['count_pois', 'list_pois']
    Similarities: ['0.613', '0.496']

  Query: Create a map showing all hospitals around 23.8103, 90.4125...
    Expected: list_pois
    Got: geocode_place
    Selected tools: ['list_pois', 'geocode_place']
    Similarities: ['0.514', '0.474']

  Query: If I'm at 23.8700, 90.3950 and need a hospital urgently, which is fast...
    Expected: find_nearest_poi_with_route
    Got: calculate_route
    Selected tools: ['generate_isochrone', 'calculate_route']
    Similarities: ['0.444', '0.439']

  Query: Are there more schools or hospitals in the Uttara area near 23.8747, 9...
    Expected: count_pois_multiple_types
    Got: list_pois
    Selected tools: ['list_pois', 'geocode_place']
    Similarities: ['0.295', '0.266']

  Query: Find a place called Uttara Medical College and then show me pharmacies...
    Expected: geocode_place
    Got: find_nearest_poi_with_route
    Selected tools: ['list_pois', 'find_nearest_poi_with_route']
    Similarities: ['0.204', '0.184']

Speed Analysis:
  Fastest: 4.02s - What are the GPS coordinates of Dhanmondi Lake?...
  Slowest: 57.50s - Compare hospitals, pharmacies, and schools within ...

================================================================================
SYSTEM PERFORMANCE SUMMARY
================================================================================
Total tools available: 8
Tools used per query: 2 (via semantic selection)
Overall accuracy: 61.9%
Average latency: 19.85s
Token efficiency: ~351 tokens/query (vs ~800 for all 8 tools)
================================================================================
